var SYNAPSEUI=function(){var s=$("#span-filter-type"),f=$("#txt-filter"),h=$("#listbox-plan-list"),i=$("#grid-plan-history"),e=$("#code-result-plan"),c=$("#treelist-dynamic-params"),t=$("#diagram-plan-status"),vt=$("#diagram-result-plan"),l=$("#txt-request-number"),n=kendo.observable({selectedPlanName:"",selectedInstanceId:"",lastExecutedInstanceId:"",isExecute:!0,tabstripSelected:"",isReset:function(){return!this.get("isExecute")},planSelected:function(){return this.get("selectedPlanName")!==""},planExecuted:function(){return this.get("lastExecutedInstanceId")!==""}});n.bind("change",function(n){var i,f,t;console.log("planVM.change() is called.",n);switch(n.field){case"selectedPlanName":this.set("isExecute",!0);this.set("lastExecutedInstanceId","");o();r();y();break;case"selectedInstanceId":v();this.get("selectedInstanceId")===""||(i=this.get("selectedPlanName"),f=this.get("selectedInstanceId"),$.ajax({async:!0,method:"GET",url:u("GetPlanStatus","Home"),data:{planUniqueName:i,planInstanceId:f},dataType:"json"}).done(function(n){var t=JSON.stringify(n,null,4);e.html(t)}).fail(function(){e.html("There was a problem reading the file")}));break;case"lastExecutedInstanceId":r();break;case"tabstripSelected":t=this.get("tabstripSelected");t==="Status"?r():t==="History"&&o()}});var a=function(){f.keyup(function(n){console.log("txt-filter.keyup() is called.",n);h.data("kendoListBox").dataSource.read()});s.click(function(n){console.log("span-filter-type.click() is called.",n);$(this).toggleClass("regex-filter in-string-filter");f.attr("placeholder",$(this).hasClass("regex-filter")?"RegEx Filter":"In-String Filter")})},v=function(){e.empty().closest("pre").scrollTop(0).scrollLeft(0)},o=function(){n.get("selectedPlanName")===""?i.data("kendoGrid").dataSource.data([]):i.getKendoGrid().dataSource.read()},r=function(){n.get("selectedPlanName")===""?t.data("kendoDiagram").dataSource.data([]):t.getKendoDiagram().dataSource.read()},y=function(){n.get("selectedPlanName")===""?c.data("kendoTreeList").dataSource.data([]):c.data("kendoTreeList").dataSource.read()},u=function(n,t){return $("base").attr("href")+t+"/"+n},p=function(){t.kendoDiagram({autoBind:!1,editable:!1,selectable:{multiple:!1},dataSource:{transport:{read:{url:u("GetPlanStatusForDiagram","Home"),data:SYNAPSEUI.diagramPlanStatusData,type:"Get"}},schema:{model:{id:"Name",fields:{Status:{type:"string"},StatusColor:{type:"string"}},children:"Actions"}}},layout:{type:"Tree",subType:"Down",horizontalSeparation:30,verticalSeparation:30},shapeDefaults:{visual:SYNAPSEUI.diagramPlanStatusVisualTemplate,editable:{drag:!1}},connectionDefaults:{stroke:{color:"#787878",width:1},editable:!1,endCap:{type:"ArrowEnd",fill:{color:"#979797"}}},dataBound:SYNAPSEUI.diagramPlanStatusDataBound});var n=t.getKendoDiagram();n.bringIntoView(n.shapes)},w=function(){p();a();kendo.bind(document.body,n)},b=function(){console.log("btnRefreshPlanListClick is running");h.data("kendoListBox").dataSource.read()},k=function(){return{filterString:f.val(),isRegexFilter:s.hasClass("regex-filter")}},d=function(t){console.log("listboxPlanListChange is running");var i=$(t.sender.wrapper).find(".k-item.k-state-selected").text();n.set("selectedPlanName",i)},g=function(){console.log("listboxPlanListDataBound is running");n.set("selectedPlanName","")},nt=function(t){console.log("tabstripSelect is running");n.set("tabstripSelected",$(t.item).find("> .k-link").text())},tt=function(){console.log("gridPlanHistoryData is running");var t=n.get("selectedPlanName");return{planUniqueName:t}},it=function(t){console.log("gridPlanHistoryDataBound is running");var r=t.sender.wrapper.children(".k-grid-content");r.scrollLeft(0);r.scrollTop(0);i.getKendoGrid().dataSource.data().length!==0&&setTimeout(function(){i.getKendoGrid().select(t.sender.tbody.find("tr:first"))},50);n.set("selectedInstanceId","")},rt=function(t){console.log("gridPlanHistoryChange is running");var i=t.sender.dataItem(this.select());n.set("selectedInstanceId",i.PlanInstanceId)},ut=function(){o()},ft=function(){console.log("treelistDynamicParamsData is running");var t=n.get("selectedPlanName");return{planUniqueName:t}},et=function(){var i,t,r;console.log("btnExecutePlanClick is running");n.get("isExecute")&&(i=n.get("selectedPlanName"),t={},$.each($(".js-dynamic-value"),function(n,i){i.value=i.value.trim();var r=$(this).closest("tr").find(".js-pass-blank");i.value.length!==0?(t[i.name]=i.value,r.prop("checked",!1)):r.is(":checked")&&(t[i.name]=i.value)}),r={PlanUniqueName:i,RequestNumber:l.val().trim().length===0?null:l.val().trim(),DynamicParameters:t},$.ajax({async:!0,method:"POST",url:u("StartPlan","Home"),contentType:"application/json",data:JSON.stringify(r),dataType:"text"}).done(function(t){var i=JSON.stringify(t,null,4);n.set("lastExecutedInstanceId",t);n.set("isExecute",!1);kendo.alert(t)}).fail(function(){alert("There was a problem when trying to execute the plan")}))},ot=function(){n.set("isExecute",!0)},st=function(){console.log("btnCancelPlanClick is running");$.ajax({async:!0,method:"POST",url:u("CancelPlan","Home"),data:{planUniqueName:n.get("selectedPlanName"),planInstanceId:n.get("lastExecutedInstanceId")},dataType:"text"}).done(function(){}).fail(function(){alert("There was a problem when trying to cancel the plan")})},ht=function(){console.log("diagramPlanStatusData is running");var t=n.get("selectedPlanName"),i=n.get("lastExecutedInstanceId");return i===""?{planUniqueName:t}:{planUniqueName:t,planInstanceId:n.get("lastExecutedInstanceId")}},ct=function(n){var t=kendo.dataviz,u=new t.diagram.Group,i=n.dataItem,f=i.Status==="Complete"?"#63c163":i.Status==="Failed"?"#f7505a":"#70bfe4",e=i.IsActionGroup?2:1,r;return u.append(new t.diagram.Rectangle({width:200,height:75,stroke:{color:f,width:e}})),i.IsActionGroup&&u.append(new t.diagram.Rectangle({width:7,height:75,x:0,y:0,stroke:{width:0},fill:{color:f}})),r=new t.diagram.Layout(new t.diagram.Rect(0,0,200,75),{alignContent:"center",alignItems:"center",justifyContent:"center",orientation:"vertical"}),u.append(r),r.append(new t.diagram.TextBlock({text:i.Name,fontSize:12,fill:"#787878"})),r.append(new t.diagram.TextBlock({text:i.Status,fontSize:12,fill:"#787878"})),r.reflow(),u},lt=function(){var n=t.getKendoDiagram(),f,i;if(console.log("diagramPlanStatusDataBound is running"),n.dataSource.data().length!==0){for(f=n.connections.length,i=0;i<f;i++){var e=n.connections[i].from,o=n.connections[i].to,s=e.getPosition("bottom"),h=o.getPosition("top"),l={x:s.x,y:s.y},a={x:h.x,y:h.y};n.connections[i].source(e.connectors[1]);n.connections[i].target(o.connectors[0]);n.connections[i].redraw({stroke:{width:1,color:"#979797"},points:[l,a]})}var r=n.viewport(),c=n.boundingBox(),u=Math.min(r.width/(c.width+50),r.height/(c.height+50));u=u<1?u<.5?.5:u:1;n.zoom(u,new kendo.dataviz.diagram.Point(r.x+r.width/2),r.y+r.height/2);n.pan(new kendo.dataviz.diagram.Point(-20,0))}},at=function(){console.log("btnRefreshPlanStatusClick is running");r()};return{init:w,btnRefreshPlanListClick:b,listboxPlanListData:k,listboxPlanListChange:d,listboxPlanListDataBound:g,tabstripSelect:nt,gridPlanHistoryData:tt,gridPlanHistoryDataBound:it,gridPlanHistoryChange:rt,btnRefreshPlanHistoryClick:ut,treelistDynamicParamsData:ft,btnExecutePlanClick:et,btnResetClick:ot,btnCancelPlanClick:st,diagramPlanStatusData:ht,diagramPlanStatusVisualTemplate:ct,diagramPlanStatusDataBound:lt,btnRefreshPlanStatusClick:at}}();$.ajaxSetup({timeout:6e4,error:function(n){alert(n.statusText)}});$(document).ready(function(){SYNAPSEUI.init()});